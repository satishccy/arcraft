<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arcraft Browser IPFS Upload Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus, input[type="file"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        
        .file-info {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e1e5e9;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #667eea;
        }
        
        .ipfs-link {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .ipfs-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Arcraft Browser IPFS Upload Test</h1>
        
        <div class="form-group">
            <label for="pinataJWT">Pinata JWT Token:</label>
            <input type="text" id="pinataJWT" placeholder="Enter your Pinata JWT token">
            <small style="color: #666; font-size: 12px;">Your token is stored locally and only used for testing</small>
        </div>
        
        <div class="test-section">
            <h3>üìÅ Test 1: File Upload</h3>
            <div class="form-group">
                <label for="fileInput">Select a file to upload:</label>
                <input type="file" id="fileInput" accept="*/*">
                <div id="fileInfo" class="file-info" style="display: none;"></div>
            </div>
            <button onclick="testFileUpload()" id="fileUploadBtn">Upload File</button>
            <div id="fileResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>üèóÔ∏è Test 2: IPFS Class Upload</h3>
            <div class="form-group">
                <label for="classFileInput">Select a file for IPFS class test:</label>
                <input type="file" id="classFileInput" accept="*/*">
                <div id="classFileInfo" class="file-info" style="display: none;"></div>
            </div>
            <button onclick="testIPFSClassUpload()" id="classUploadBtn">Upload via IPFS Class</button>
            <div id="classResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>üìÑ Test 3: JSON Metadata Upload</h3>
            <button onclick="testJSONUpload()" id="jsonUploadBtn">Upload Test JSON Metadata</button>
            <div id="jsonResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>üìä Test Summary</h3>
            <div id="summary" class="info" style="display: none;">
                No tests completed yet.
            </div>
        </div>
    </div>

    <!-- Load the arcraft library from the built dist folder -->
    <script src="../dist/browser/arcraft.min.js"></script>

    <script>
        // Import from the built ESM module
        const { IPFS, uploadToPinata, uploadJsonToPinata } = arcraft;
        
        // Make functions available globally
        window.IPFS = IPFS;
        window.uploadToPinata = uploadToPinata;
        window.uploadJsonToPinata = uploadJsonToPinata;
        
        let testResults = {
            fileUpload: null,
            classUpload: null,
            jsonUpload: null
        };
        
        // File input change handlers
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const fileInfo = document.getElementById('fileInfo');
            if (file) {
                fileInfo.style.display = 'block';
                fileInfo.innerHTML = `
                    <strong>Selected File:</strong><br>
                    Name: ${file.name}<br>
                    Size: ${(file.size / 1024).toFixed(2)} KB<br>
                    Type: ${file.type || 'Unknown'}<br>
                    Last Modified: ${new Date(file.lastModified).toLocaleDateString()}
                `;
            } else {
                fileInfo.style.display = 'none';
            }
        });
        
        document.getElementById('classFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const fileInfo = document.getElementById('classFileInfo');
            if (file) {
                fileInfo.style.display = 'block';
                fileInfo.innerHTML = `
                    <strong>Selected File:</strong><br>
                    Name: ${file.name}<br>
                    Size: ${(file.size / 1024).toFixed(2)} KB<br>
                    Type: ${file.type || 'Unknown'}<br>
                    Last Modified: ${new Date(file.lastModified).toLocaleDateString()}
                `;
            } else {
                fileInfo.style.display = 'none';
            }
        });
        
        // Save JWT token to localStorage
        document.getElementById('pinataJWT').addEventListener('input', function(e) {
            localStorage.setItem('pinataJWT', e.target.value);
        });
        
        // Load JWT token from localStorage
        const savedJWT = localStorage.getItem('pinataJWT');
        if (savedJWT) {
            document.getElementById('pinataJWT').value = savedJWT;
        }
        
        window.testFileUpload = async function() {
            const jwt = document.getElementById('pinataJWT').value;
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const resultDiv = document.getElementById('fileResult');
            const btn = document.getElementById('fileUploadBtn');
            
            if (!jwt) {
                showResult(resultDiv, 'error', 'Please enter your Pinata JWT token');
                return;
            }
            
            if (!file) {
                showResult(resultDiv, 'error', 'Please select a file to upload');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Uploading...';
            
            try {
                showResult(resultDiv, 'info', 'Uploading file to IPFS...');
                
                const result = await uploadToPinata({
                    file: file,
                    name: `browser-test-${file.name}`,
                    token: jwt
                });
                
                testResults.fileUpload = result.IpfsHash;
                updateSummary();
                
                const successMessage = `‚úÖ File upload successful!
                
IPFS Hash: ${result.IpfsHash}
Size: ${result.PinSize} bytes
Timestamp: ${result.Timestamp}
${result.isDuplicate ? 'Note: This file was already pinned' : ''}

üîó IPFS URL: https://gateway.pinata.cloud/ipfs/${result.IpfsHash}
üîó Alternative: https://ipfs.io/ipfs/${result.IpfsHash}`;
                
                showResult(resultDiv, 'success', successMessage);
                
            } catch (error) {
                console.error('Upload error:', error);
                const errorMessage = `‚ùå Upload failed: ${error.message}
                
${error.response ? `HTTP Status: ${error.response.status}
Response: ${JSON.stringify(error.response.data, null, 2)}` : ''}`;
                showResult(resultDiv, 'error', errorMessage);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Upload File';
            }
        };
        
        window.testIPFSClassUpload = async function() {
            const jwt = document.getElementById('pinataJWT').value;
            const fileInput = document.getElementById('classFileInput');
            const file = fileInput.files[0];
            const resultDiv = document.getElementById('classResult');
            const btn = document.getElementById('classUploadBtn');
            
            if (!jwt) {
                showResult(resultDiv, 'error', 'Please enter your Pinata JWT token');
                return;
            }
            
            if (!file) {
                showResult(resultDiv, 'error', 'Please select a file to upload');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Uploading...';
            
            try {
                showResult(resultDiv, 'info', 'Uploading file via IPFS class...');
                
                const ipfs = new IPFS('pinata', {
                    provider: 'pinata',
                    jwt: jwt
                });
                
                const ipfsHash = await ipfs.upload(file, `class-test-${file.name}`);
                
                testResults.classUpload = ipfsHash;
                updateSummary();
                
                const successMessage = `‚úÖ IPFS class upload successful!
                
IPFS Hash: ${ipfsHash}

üîó IPFS URL: https://gateway.pinata.cloud/ipfs/${ipfsHash}
üîó Alternative: https://ipfs.io/ipfs/${ipfsHash}`;
                
                showResult(resultDiv, 'success', successMessage);
                
            } catch (error) {
                console.error('IPFS class upload error:', error);
                const errorMessage = `‚ùå IPFS class upload failed: ${error.message}
                
${error.response ? `HTTP Status: ${error.response.status}
Response: ${JSON.stringify(error.response.data, null, 2)}` : ''}`;
                showResult(resultDiv, 'error', errorMessage);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Upload via IPFS Class';
            }
        };
        
        window.testJSONUpload = async function() {
            const jwt = document.getElementById('pinataJWT').value;
            const resultDiv = document.getElementById('jsonResult');
            const btn = document.getElementById('jsonUploadBtn');
            
            if (!jwt) {
                showResult(resultDiv, 'error', 'Please enter your Pinata JWT token');
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'Uploading...';
            
            try {
                showResult(resultDiv, 'info', 'Uploading JSON metadata...');
                
                const testMetadata = {
                    name: 'Browser Test NFT',
                    description: 'This is a test NFT metadata created by arcraft browser test',
                    image: testResults.fileUpload ? `ipfs://${testResults.fileUpload}` : 'ipfs://QmYourImageHashHere',
                    attributes: [
                        {
                            trait_type: 'Environment',
                            value: 'Browser'
                        },
                        {
                            trait_type: 'Test Type',
                            value: 'Interactive'
                        },
                        {
                            trait_type: 'User Agent',
                            value: navigator.userAgent.split(' ')[0]
                        }
                    ],
                    timestamp: new Date().toISOString(),
                    testData: {
                        screenWidth: window.screen.width,
                        screenHeight: window.screen.height,
                        language: navigator.language,
                        platform: navigator.platform
                    }
                };
                
                const result = await uploadJsonToPinata({
                    json: testMetadata,
                    name: 'browser-test-metadata.json',
                    token: jwt
                });
                
                testResults.jsonUpload = result.IpfsHash;
                updateSummary();
                
                const successMessage = `‚úÖ JSON upload successful!
                
IPFS Hash: ${result.IpfsHash}
Size: ${result.PinSize} bytes
Timestamp: ${result.Timestamp}

üîó IPFS URL: https://gateway.pinata.cloud/ipfs/${result.IpfsHash}
üîó Alternative: https://ipfs.io/ipfs/${result.IpfsHash}

üìÑ Uploaded Metadata:
${JSON.stringify(testMetadata, null, 2)}`;
                
                showResult(resultDiv, 'success', successMessage);
                
            } catch (error) {
                console.error('JSON upload error:', error);
                const errorMessage = `‚ùå JSON upload failed: ${error.message}
                
${error.response ? `HTTP Status: ${error.response.status}
Response: ${JSON.stringify(error.response.data, null, 2)}` : ''}`;
                showResult(resultDiv, 'error', errorMessage);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Upload Test JSON Metadata';
            }
        };
        
        function showResult(element, type, message) {
            element.className = `result ${type}`;
            element.textContent = message;
            element.style.display = 'block';
        }
        
        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            const completedTests = Object.values(testResults).filter(result => result !== null).length;
            
            if (completedTests === 0) {
                summaryDiv.style.display = 'none';
                return;
            }
            
            let summaryText = `üéâ Completed ${completedTests}/3 tests:\n\n`;
            
            if (testResults.fileUpload) {
                summaryText += `‚úÖ File Upload: ${testResults.fileUpload}\n`;
            }
            if (testResults.classUpload) {
                summaryText += `‚úÖ IPFS Class Upload: ${testResults.classUpload}\n`;
            }
            if (testResults.jsonUpload) {
                summaryText += `‚úÖ JSON Upload: ${testResults.jsonUpload}\n`;
            }
            
            if (completedTests === 3) {
                summaryText += `\nüèÜ All browser tests completed successfully!`;
            }
            
            summaryDiv.textContent = summaryText;
            summaryDiv.style.display = 'block';
        }
        
        console.log('üöÄ Arcraft browser test loaded successfully!');
        console.log('üì¶ Available functions:', { IPFS, uploadToPinata, uploadJsonToPinata });
    </script>
</body>
</html> 